#include <stdio.h>
#include <stdlib.h>
#include <string.h> //memset, strncmp, strsignal
#include <unistd.h>
#include <sys/wait.h>
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/syscall.h>
#include <sys/user.h>
#include <asm/ptrace-abi.h>
#include <asm/ptrace.h>
#include <udis86.h>

#define L_ENDIAN 0x01 // LSB to the right
#define B_ENDIAN 0x10 // LSB to the left
#define LOC_ENDIAN 0x5 // Endianness 1 byte
#define LOC_PH 0x1C // Program header start 4 bytes
#define LOC_SH 0x20 // Section header start 4 bytes
#define SIZE_PH 0x2A // Program header size 2 bytes
#define SIZE_SH 0x2E // Section header size 2 bytes
#define NUM_PH 0x2C // num entries in Program header 2 bytes
#define NUM_SH 0x30 // num entries in Section header 2 bytes
#define IDX_SNAME 0x32 // index of section header entry that contain section names 2 bytes 

0x1C 	0x20 	4 	8 	e_phoff 	Points to the start of the program header table. It usually follows the file header immediately making the offset 0x40 for 64-bit ELF executables.
0x20 	0x28 	4 	8 	e_shoff 	Points to the start of the section header table.
0x24 	0x30 	4 	e_flags 	Interpretation of this field depends on the target architecture.
0x28 	0x34 	2 	e_ehsize 	Contains the size of this header, normally 64 bytes for 64-bit and 52 for 32-bit format.
0x2A 	0x36 	2 	e_phentsize 	Contains the size of a program header table entry.
0x2C 	0x38 	2 	e_phnum 	Contains the number of entries in the program header table.
0x2E 	0x3A 	2 	e_shentsize 	Contains the size of a section header table entry.
0x30 	0x3C 	2 	e_shnum 	Contains the number of entries in the section header table.
0x32 	0x3E 	2 	e_shstrndx 	Contains index of the section header table entry that contains the section names.

int main(int argc, char* argv[])
{
  FILE *target;
  target = fopen("./a.out", "a+");
  if (!target) {
    printf("unable to open file");
    return 1;
  }
  unsigned char buff;
  unsigned long location = 0;
  unsigned long target_size = 0; 
  fseek (target , 0 , SEEK_END);
  target_size = ftell (target);
  rewind (target);
  printf("target size: %ld Bytes\n", target_size);
  int i;
  for (i = 0; i < target_size; i ++) {
    location = ftell(target);
    printf("%08lx: ", location);
    fread(&buff, 1, 1, target);
    printf("%02x\n", (unsigned int)buff);
  }

  fclose(target);

  return 0;
}
